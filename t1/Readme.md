# Задание 1 — Python C API

Всем требованиям со странички вики соответствует: есть python биндинги и обертка,
нормальное взаимодействие с памятью, деструкторы.

Так как тесты изначально на C, include-файл `widgets.h` сделан так, что его можно инклюдить и из C, и из C++.
Из-за этого полноценного наследования структур нет, но, так как содержимое стркутур на самом деле одно и то же
(указатель на QT объект и enum с типом), проблем на возникает. К примеру, любую из структур можно
привести к `Object*` и передать в `Object_Delete()`.

## Сборка

Сборка с помощью cmake. Есть некоторые особенности, связанные с тем, что для такого небольшого проекта я не стал настраивать
полную процедуру сборки/дистрибьюции.

Во-первых, выходной путь для скомпилированных `.so`/`.a`/бинарников
[прибит гвоздями](https://github.com/AmatanHead/yarpo/blob/master/t1/CMakeLists.txt#L7)
к `./build`. Даже при out-of-source build
финальные файлы попадут туда, что мне кажется удобным.

Во-вторых, отсутствует setup.py, так как мы не собираемся это распространять.

В-третьих, я не стал использовать `add_python_module`, потому что эта функция делает ровно то же самое,
что делается [тут](https://github.com/AmatanHead/yarpo/blob/master/t1/src/CMakeLists.txt#L27)
и [тут](https://github.com/AmatanHead/yarpo/blob/master/t1/pywidgets/CMakeLists.txt#L5),
не является какой-то сверхсложной или особо нужной абстракцией,
и, вместе с тем, делает процесс сборки менее настраиваемым/наглядным.

В целом, всё устроено следующим образом:
 - собирается статическая библиотека `libwidgets.a`
 - с этой библиотекой собираются первые два теста
 - остальные три теста копируются к бинарникам первых двух, чтобы можно было запускать всё из одной директории
   (там же на них делается `chmod +x`)
 - из статическаой библиотеки `libwidgets.a` собирается динамическая библиотека `_pywidgets.so`
 - `_pywidgets.so` копируется в `./pywidgets/_pywidgets.so`

## Тесты

Так как в питоновских тестах руками устанавливается `sys.path`, запускать их нужно из корневой директории
(в которой лежит этот readme):
```
$ ./build/test1 && echo $?
$ ./build/test2 && echo $?
$ ./build/test3 && echo $?
$ ./build/test4 && echo $?
$ ./build/test5 && echo $?
```

